#REGLAS MOD SECURITY PERSONALIZADAS#
#### VERSION NORMAL AUTOINSTALADOR MALWARE-EXPERT + DDOS ADMIN. V1. 06-09-2018 ####

SecDataDir /tmp

SecResponseBodyAccess On
SecResponseBodyLimit 546870912
SecRequestBodyInMemoryLimit 546870912

SecAction "phase:2,initcol:ip=%{REMOTE_ADDR},id:'4000',pass,nolog"

#SecRule REQUEST_HEADERS:User-Agent "WPScan" "deny,log,noauditlog,severity:2,msg:'WPScan blocked',status:403,id:'4001'"
SecRule REQUEST_HEADERS:User-Agent "(WPScan|AhrefsBot|Anonymizer|Attributor|Baidu|Bandit|BatchFTP|Bigfoot|Black.Hole|Bork-edition|DataCha0s|Deepnet Explorer|desktopsmiley|DigExt|feedfinder|gamingharbor|heritrix|ia_archiver|Indy Library|Jakarta|Java|juicyaccess|larbin|linkdex|Missigua|MRSPUTNIK|Nutch|panscient|plaNETWORK|Snapbot|Sogou|TinEye|TwengaBot|Twitturly|Viewzi|WebCapture|XX|Yandex|YebolBot|MJ12bot|masscan|baidu|Yandex|RSSingBot|Scanbot|betaBot|DotBot|mj12bot|FeedFetcher|seoscanners.net|Moreover|ltx71|inboundlinks.win|sitebot)$" "deny,log,noauditlog,severity:2,msg:'WPScan blocked',status:403,id:'4001'"

#SecRule REQUEST_URI "@contains /wp-content/plugins" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=30,id:'4002'"
SecRule REQUEST_URI "@contains /robots\.txt" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4003'"
SecRule REQUEST_URI "@contains /readme\.html" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4004'"
SecRule REQUEST_URI "@contains /wp-includes/rss-functions.php" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4005'"
SecRule REQUEST_URI "@contains /wp-content/debug\.log" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4006'"
SecRule REQUEST_URI "@contains /wp-config" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4007'"
#SecRule REQUEST_URI "@contains /config" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4008'"
SecRule REQUEST_URI "@contains /configuration" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4009'"
SecRule REQUEST_URI "@contains /settings.inc." "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4010'"
#SecRule REQUEST_URI "@contains /settings" "phase:2,pass,setvar:ip.block_script=+5,expirevar:ip.block_script=300,id:'4011'"

#SecRule RESPONSE_STATUS "@streq 404" "phase:5,pass,setvar:ip.block_script=+1,expirevar:ip.block_script=300,id:'4012'"
#SecRule RESPONSE_STATUS "@streq 403" "phase:5,pass,setvar:ip.block_script=+1,expirevar:ip.block_script=300,id:'4013'"
SecRule ip:block_script "@ge 30" "phase:2,deny,status:403,id:'4014'"

#SecAction "phase:2,initcol:ip=%{REMOTE_ADDR},id:'4000',pass,nolog"
#SecRule RESPONSE_STATUS "@streq 404" "phase:5,pass,setvar:ip.block_script=+1,expirevar:ip.block_script=10,id:'4001'"
#SecRule RESPONSE_STATUS "@streq 403" "phase:5,pass,setvar:ip.block_script=+1,expirevar:ip.block_script=10,id:'4002'"
#SecRule ip:block_script "@ge 30" "phase:2,deny,status:403,id:'4003'"

# ignore requests from localhost or some other IP
#SecRule REMOTE_ADDR "^127\.0\.0\.1$" "phase:1,nolog,allow"

# for all non static urls count requests per second per ip
# (increase var requests by one, expires in 1 second)
#SecRule REQUEST_BASENAME "!(\.avi$|\.bmp$|\.css$|\.doc$|\.flv$|\.gif$|\.ico$|\.jpg$|\.js$|\.mp3$|\robots.txt$|\.mpeg$|\.pdf$|\.png$|\.pps$|\.ppt$|\.swf$|\.wmv$|\.xls$|\.xml$|\.zip$)" "phase:1,nolog,pass,initcol:ip=%{REMOTE_ADDR},setvar:ip.requests=+1,expirevar:ip.requests=1,id:9991"

# if there where more than 5 requests per second for this IP
# set var block to 1 (expires in 5 seconds) and increase var blocks by one (expires in an hour)
#SecRule ip:requests "@eq 10" "phase:1,pass,nolog,setvar:ip.block=1,expirevar:ip.block=5,setvar:ip.blocks=+1,expirevar:ip.blocks=60,id:9992"

# if user was blocked more than 5 times (var blocks>5), log and return http 403
#SecRule ip:blocks "@ge 10" "phase:1,deny,log,logdata:'req/sec: %{ip.requests}, blocks: %{ip.blocks}',status:403,id:9993"

# if user is blocked (var block=1), log and return http 403
#SecRule ip:block "@eq 1" "phase:1,deny,log,logdata:'req/sec: %{ip.requests}, blocks: %{ip.blocks}',status:403,id:9994"

# 403 is some static page or message
#ErrorDocument 403 "<center><h2>take it easy yo!"

#SecAction "phase:2,id:200000,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"
#SecRule REQUEST_URI "@contains /wp-login.php" "id:200006,t:none,nolog,drop,chain,phase:2,setvar:ip.ddos=+1,deprecatevar:ip.ddos=2/60,expirevar:ip.ddos=600"
#SecRule IP:DDOS "@gt 4" "t:none,nolog"

#SecAction "phase:2,id:400000,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"
#SecRule REQUEST_URI "@contains /xmlrpc.php" "id:400001,t:none,nolog,drop,chain,phase:2,setvar:ip.ddos=+1,deprecatevar:ip.ddos=2/60,expirevar:ip.ddos=120"
#SecRule IP:DDOS "@gt 5" "t:none,nolog"

#SecAction "phase:2,id:200002,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"
#SecRule REQUEST_URI "@contains administrator/index.php" "id:200003,t:none,nolog,drop,chain,phase:2,setvar:ip.ddos=+1,deprecatevar:ip.ddos=2/60,expirevar:ip.ddos=120"
#SecRule IP:DDOS "@gt 5" "t:none,nolog"

#<Location ~ /administrator>
#	SecDefaultAction phase:2,deny,status:403,log,auditlog
#	SecRule IP:bf_counter "@eq 3" "id:200002,phase:2,log,block,expirevar:IP.bf_counter=300,msg:'IP address blocked because of a suspected brute force attack on the Joomla website'"
#	SecRule ARGS:option "@streq com_login" "id:200003,phase:2,chain,t:none,log,pass,msg:'Multiple Joomla authentication failures from IP address', setvar:IP.bf_counter=+1"
#</Location>

#SecAction "phase:2,id:200004,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"
#SecRule REQUEST_URI "@contains admin/index.php" "id:200005,t:none,nolog,drop,chain,phase:2,setvar:ip.ddos=+1,deprecatevar:ip.ddos=2/60,expirevar:ip.ddos=120"
#SecRule IP:DDOS "@gt 5" "t:none,nolog"


#bloqueo fichero readme.txt
SecRule REQUEST_URI "^\S+readme\.txt$" "log,deny,msg:'Acceso denegado',status:403,id:30501"
SecRule REQUEST_URI "^\S+readme\.txt\S+$" "log,deny,msg:'Acceso denegado',status:403,id:3601"
SecRule REQUEST_URI "^\S+readme\.html$" "log,deny,msg:'Acceso denegado',status:403,id:30502"
SecRule REQUEST_URI "^\S+readme\.html\S+$" "log,deny,msg:'Acceso denegado',status:403,id:3602"

# ---------------------------------------------------------------
# Malware.Expert - Generic rule  Set ver.1.0.32
# Copyright (C) 2010-2017 Willberg Co Oy All rights reserved.
# ---------------------------------------------------------------
#
# Do not copy, cite, or distribute without permission of the author anywhere
#
# If you can read this file you need delete this!
#
# Dont try steal our rules!
#
# Your IP and access is logged our database!
#
# https://www.exploit-db.com/platform/?p=php
# https://0day.today/
# https://cxsecurity.com/exploit/
# http://iedb.ir/
#

#
# https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQBODY_ERROR
# LiteSpeed not support
SecRule REQBODY_ERROR 			"!@eq 0" 		"phase:2,id:200001,t:none,log,deny,msg:'Malware.Expert - Failed to parse request body: %{reqbody_error_msg}'"

#
# https://malware.expert/modsecurity/prevent-ddos-to-xmlrpc-php-wordpress-with-modsecurity/
# ModSecurity v3 / nginx not support deprecatevar
#SecAction "phase:2,id:400000,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"
#SecRule REQUEST_URI "@contains /xmlrpc.php" "id:400001,t:none,nolog,drop,chain,phase:2,setvar:ip.ddos=+1,deprecatevar:ip.ddos=2/60,expirevar:ip.ddos=120"
#SecRule IP:DDOS "@gt 5" "t:none,nolog"

#
# null characters
#
SecRule ARGS|ARGS_NAMES|REQUEST_HEADERS|!REQUEST_HEADERS:Referer "@validateByteRange 1-255" "phase:2,drop,msg:'Malware.Expert - Invalid character in request',id:'400015',t:none,t:urlDecodeUni"

#
# Request_Body - Need change to scan files
#
SecRule	REQUEST_HEADERS:Content-Type    "text/php"              		"id:400050, phase:1,t:none,t:lowercase,nolog,pass,ctl:requestBodyProcessor=URLENCODED"
SecRule	REQUEST_HEADERS:Content-Type    "text/plain"              		"id:400051, phase:1,t:none,t:lowercase,nolog,pass,ctl:requestBodyProcessor=URLENCODED"
SecRule	REQUEST_HEADERS:Content-Type    "text/html"              		"id:400052, phase:1,t:none,t:lowercase,nolog,pass,ctl:requestBodyProcessor=URLENCODED"
#SecRule	REQUEST_HEADERS:Content-Type    "application/x-php"              	"id:400053, phase:1,t:none,t:lowercase,nolog,pass,ctl:requestBodyProcessor=URLENCODED"

#
# PHP Inside Images
# 2017.01.17 (Fixed - phase2 not working)
#

SecRule REQUEST_METHOD "POST"   	                                               	"id:400900,phase:1,t:none,chain,deny,log,msg:'Malware.Expert - Images - POST Payload'"
SecRule REQUEST_FILENAME "^/.+\.jpg$" 	 						"t:none,t:lowercase,t:urldecode,t:normalizePath"
SecRule REQUEST_METHOD "POST"                                                         	"id:400901,phase:1,t:none,chain,deny,log,msg:'Malware.Expert - Images - POST Payload'"
SecRule REQUEST_FILENAME "^/.+\.jpeg$" 							"t:none,t:lowercase,t:urldecode,t:normalizePath"
SecRule REQUEST_METHOD "POST"                                                         	"id:400902,phase:1,t:none,chain,deny,log,msg:'Malware.Expert - Images - POST Payload'"
SecRule REQUEST_FILENAME "^/.+\.png$"  							"t:none,t:lowercase,t:urldecode,t:normalizePath"

#
# Whitelist start
#
# Note: https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_URI
# The skipAfter action works only within the current processing phase and not necessarily the order in which the rules appear in the configuration file. If you place a phase 2 rule after a phase 1 rule that uses skip, it will not skip over the phase 2 rule. It will skip over the next phase 1 rule that follows it in the phase.
#
SecRule REQUEST_FILENAME 		".(?:jpe?g|gif|png|js|exe)$"           	"id:400400,phase:1,t:none,allow,nolog"

# Rule 400401: timthumb
SecRule REQUEST_URI			"(?:timthumb\.php|thumb\.php)"		"id:400401,phase:2,t:none,t:lowercase,t:urldecode,chain,pass,skipAfter:IGNORE_HTTP_STRING,nolog,msg:'Malware.Expert - request_uri: TimThumb'"
SecRule QUERY_STRING    		"(?:link|src)=.+(?:jpeg|gif|png|bmp|jpg)"	"t:none,t:lowercase,t:urldecode,nolog"

# Rule 400402: Wordpress redirect
SecRule REQUEST_URI			"wp-login\.php\?redirect_to="		"id:400402,phase:2,t:none,t:lowercase,t:urldecode,pass,skipAfter:IGNORE_HTTP_STRING,nolog,msg:'Malware.Expert - request_uri: wordpress redirect'"

# Rule 400403: This appears to be WHMCS installation which is converting the images to certain width and height
SecRule REQUEST_URI			"@contains /image.php?"			"id:400403,phase:2,t:none,t:lowercase,t:urldecode,chain,pass,skipAfter:IGNORE_HTTP_STRING,nolog,msg:'Malware.Expert - request_uri: WHMCS Image scale'"
SecRule QUERY_STRING    		"image=.+(?:jpeg|gif|png|bmp|jpg)"	"t:none,t:lowercase,t:urldecode,nolog"

# Rule 400404: https://fi.wordpress.org/plugins/easy-social-share-buttons/
SecRule REQUEST_URI			"@contains /wp-content/plugins/easy-social-share-buttons3/public/get-noapi-counts.php?"	"id:400404,phase:2,t:none,t:lowercase,t:urldecode,chain,pass,skipAfter:IGNORE_HTTP_STRING,nolog,msg:'Malware.Expert - request_uri: easy-social-share-buttons'"
SecRule ARGS:url			"@contains http://" 			"t:none,t:lowercase,t:urldecode"

#
# Skip Rules from whitelist
#

SecRule REQUEST_URI			"\.php\?http://"	"id:405000,phase:2,t:none,t:lowercase,deny,log,msg:'Malware.Expert - query_string: remote file include'"
SecRule REQUEST_URI			"=http://"		"id:405001,phase:2,t:none,t:lowercase,deny,log,msg:'Malware.Expert - request_uri: remote php file include'"
SecRule QUERY_STRING			"http://.+\.php"	"id:405002,phase:2,t:none,deny,log,msg:'Malware.Expert - query_string: remote php include'"

SecMarker	IGNORE_HTTP_STRING

# Rule 405100: CM4ALL Whitelist - Published site
SecRule REQUEST_URI			"@contains /.cm4all/"	"id:405100,phase:2,t:none,t:lowercase,t:urldecode,pass,skipAfter:IGNORE_URI,nolog,msg:'Malware.Expert - request_uri: CM4ALL'"

SecRule REQUEST_URI	"/\..+\.php"				"id:430015,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: hidden .php execute'"

SecMarker	IGNORE_URI

#
# Whitelist end
#

#
# QUERY_STRING attacks
#

SecRule QUERY_STRING			"/etc/shadow"		"id:410001,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted shell access'"
SecRule QUERY_STRING			"/sbin/"		"id:410002,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted shell access'"
#SecRule QUERY_STRING			"/.+\.html"		"id:410003,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: remote url download'"
# Rule 410004 - ../../..
SecRule QUERY_STRING			"\.\./\.\."		"id:410004,phase:2,t:none,t:normalisePath,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: directory travel'"
SecRule QUERY_STRING			"\<script"		"id:410005,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: script execute'"
#SecRule QUERY_STRING			"http://.+\.php"	"id:410006,phase:2,t:none,deny,log,msg:'Malware.Expert - query_string: remote php include'"
SecRule QUERY_STRING			"php\://"		"id:410007,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: remote php execute'"
SecRule QUERY_STRING			"/var/log/"		"id:410008,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted shell access'"
SecRule QUERY_STRING			"/bin/"			"id:410009,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted shell access'"
SecRule QUERY_STRING			"ftp\://"		"id:410010,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: remote ftp include'"
SecRule QUERY_STRING			"/etc/passwd"		"id:410011,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted shell access'"
SecRule QUERY_STRING			"/etc/group"		"id:410012,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted shell access'"
SecRule QUERY_STRING			"\<\?"			"id:410013,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: remote php execute'"
SecRule QUERY_STRING			"union.+select"		"id:410014,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: SQL execute'"
SecRule QUERY_STRING			"proc/self/cmdline"	"id:410015,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted shell access'"
SecRule QUERY_STRING			"\<iframe"		"id:410016,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: iframe'"
SecRule QUERY_STRING			"\$\("			"id:410017,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted shell access'"
SecRule QUERY_STRING			"/wp-config\.php"	"id:410018,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted wordpress config access'"
SecRule QUERY_STRING			"/configuration\.php"	"id:410019,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted joomla configuration access'"
SecRule QUERY_STRING			"allow_url_include"	"id:410020,phase:2,t:none,t:lowercase,t:urldecode,t:compressWhitespace,deny,log,msg:'Malware.Expert - query_string: remote file include'"
SecRule QUERY_STRING			"auto_prepend_file"	"id:410021,phase:2,t:none,t:lowercase,t:urldecode,t:compressWhitespace,deny,log,msg:'Malware.Expert - query_string: remote file include'"
SecRule QUERY_STRING			"select.*load_file"	"id:410022,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: SQL load file'"
SecRule QUERY_STRING			"eval\("		"id:410023,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - query_string: php remote execute'"
SecRule QUERY_STRING			"dict\://"		"id:410024,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: ssrf attack attemp'"
SecRule QUERY_STRING			"\</script"		"id:410025,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: script execute'"
SecRule QUERY_STRING                    "/config\.php"   	"id:410026,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted moodle configuration access'"
SecRule QUERY_STRING                    "/settings.inc\.php"   	"id:410027,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted prestashop configuration access'"
SecRule QUERY_STRING                    "/settings\.php"   	"id:410028,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - query_string: unwanted drupal configuration access'"

#
# http-header-user-agent attacks
#
SecRule REQUEST_HEADERS:User-Agent 	"curl " 		"id:420001,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: Curl download'"
SecRule REQUEST_HEADERS:User-Agent 	"ncftpget " 		"id:420002,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: ncftpget download'"
SecRule REQUEST_HEADERS:User-Agent 	"file_get_contents " 	"id:420003,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: file_get_contents download'"
SecRule REQUEST_HEADERS:User-Agent 	"eval\(" 		"id:420004,phase:2,t:none,t:lowercase,deny,log,msg:'Malware.Expert - user-agent: eval code'"
SecRule REQUEST_HEADERS:User-Agent 	"fetch " 		"id:420005,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: fetch'"
SecRule REQUEST_HEADERS:User-Agent 	"fopen " 		"id:420006,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: fopen'"
SecRule REQUEST_HEADERS:User-Agent 	"lwp-download "	 	"id:420007,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: lwp-download download'"
# Rule 420008 - https://www.exploit-db.com/exploits/34766/
SecRule REQUEST_LINE|REQUEST_HEADERS|REQUEST_HEADERS_NAMES "@contains () {" "id:420008,phase:2,t:none,t:lowercase,deny,log,msg:'Malware.Expert - user-agent: Bash ENV Variable Injection Attack'"
SecRule REQUEST_HEADERS:User-Agent 	"jdatabasedrivermysql" 	"id:420009,phase:2,t:none,t:lowercase,deny,log,msg:'Malware.Expert - user-agent: JDatabaseDriverMysql'"
SecRule REQUEST_HEADERS:User-Agent 	"wget " 		"id:420010,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: wget download'"
SecRule REQUEST_HEADERS:User-Agent 	"\<\?" 			"id:420011,phase:2,t:none,t:lowercase,deny,log,msg:'Malware.Expert - user-agent: php execute'"
SecRule REQUEST_HEADERS		 	"jdatabasedrivermysql" 	"id:420012,phase:2,t:none,t:lowercase,deny,log,msg:'Malware.Expert - Request Headers: JDatabaseDriverMysql'"
SecRule REQUEST_HEADERS:X-Forwarded-For	"jdatabasedrivermysql" 	"id:420013,phase:2,t:none,t:lowercase,deny,log,msg:'Malware.Expert - Request Headers: JDatabaseDriverMysql'"
SecRule &REQUEST_HEADERS:Proxy 		"@gt 0" 		"id:420014,phase:2,t:none,deny,log,msg:'Malware.Expert - Request Headres: httpoxy denied'"
SecRule REQUEST_HEADERS:User-Agent 	"lynx "	 		"id:420015,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: lynx download'"
SecRule REQUEST_HEADERS:User-Agent 	"links "		"id:420016,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: links download'"
SecRule REQUEST_HEADERS:User-Agent 	"lwp-mirror "		"id:420017,phase:2,t:none,deny,log,msg:'Malware.Expert - user-agent: lwp-mirror download'"
SecRule REQUEST_HEADERS:User-Agent 	"t0phackteam"		"id:420018,phase:2,t:none,t:lowercase,deny,noauditlog,msg:'Malware.Expert - user-agent: WebFuck T0PHackTeam www.t0p.xyz'"
SecRule REQUEST_HEADERS:User-Agent      "@contains visbot/2.0 (+http://www.visvo.com/en/webmasters.jsp;bot@visvo.com)"           "id:420019,phase:2,t:none,t:lowercase,deny,noauditlog,msg:'Malware.Expert - user-agent: Visbot - Magento credit card stealer'"
SecRule &REQUEST_HEADERS:User-Agent      "@eq 0"           				"id:420020,phase:1,t:none,chain,t:lowercase,deny,noauditlog,msg:'Malware.Expert - user-agent: empty'"
SecRule REQUEST_METHOD 			 "POST"            				"t:none,chain"
SecRule REQUEST_URI     		 "@contains /wp-login.php"                      "t:none,t:lowercase,t:urldecode"
SecRule &REQUEST_HEADERS:User-Agent      "@eq 0"           				"id:420021,phase:1,t:none,chain,t:lowercase,deny,noauditlog,msg:'Malware.Expert - user-agent: empty'"
SecRule REQUEST_METHOD 			 "POST"            				"t:none,chain"
SecRule REQUEST_URI     		 "@contains /index.php/admin/"                  "t:none,t:lowercase,t:urldecode"

#
# REQUEST_URI attacks
#
SecRule REQUEST_URI	"yakimabait/download\.php\?file=.+/wp-config\.php"		"id:430000,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: read wordpress configuration file'"
SecRule REQUEST_URI	"bslider_show_image&img=.+/wp-config\.php"			"id:430001,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: read wordpress configuration file'"
SecRule REQUEST_URI	"getfile&.+/wp-config\.php"					"id:430002,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: read wordpress configuration file'"
SecRule REQUEST_URI	"&filename=wp-config\.php&action=download"			"id:430003,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: read wordpress configuration file'"
SecRule REQUEST_URI	"wp-content/force-download\.php\?file=.+/wp-config\.php"	"id:430004,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: read wordpress configuration file'"
SecRule REQUEST_URI	".+wp-config\.php"						"id:430005,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: read wordpress configuration file'"
SecRule REQUEST_URI	"allow_url_include"						"id:430006,phase:2,t:none,t:lowercase,t:urldecode,t:compressWhitespace,deny,log,msg:'Malware.Expert - request_uri: remote file include'"
SecRule REQUEST_URI	"disable_functions"						"id:430007,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: try disable php.ini functions'"
SecRule REQUEST_URI	"concat\("							"id:430008,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: SQL injection'"
SecRule REQUEST_URI	"option=com_jce&task=plugin&plugin=imgmanager&file=imgmanager&method=form"	"id:430009,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: joomla jce upload'"
SecRule REQUEST_URI	"\.htaccess"							"id:430010,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: unwanted shell access'"
SecRule REQUEST_URI	"file_put_contents"						"id:430011,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: remote php execute'"
SecRule REQUEST_URI	"/\.html"							"id:430012,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: hidden .html execute'"
SecRule REQUEST_URI	"/\..+\.html"							"id:430013,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: hidden .html execute'"
SecRule REQUEST_URI	"/\.php"							"id:430014,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: hidden .php execute'"
# SecRule REQUEST_URI	"/\..+\.php"							"id:430015,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: hidden .php execute'"
# Rule 430016 - Drupal RESTWS Module 7.x - Remote PHP Code Execution (Metasploit): https://www.exploit-db.com/exploits/40130/
SecRule REQUEST_URI	"/passthru/"							"id:430016,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: remote php execute'"
SecRule REQUEST_URI	"/wp-content/uploads/.*\.php"					"id:430017,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: Wordpress - prevent PHP files from executing'"
SecRule REQUEST_URI	"/wp-content/plugins/.*/temp/update_extract/.*\.php"		"id:430018,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: Wordpress - prevent PHP files from executing'"
SecRule REQUEST_URI 	"/images/stories/.+\.php"					"id:430019,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: Joomla - prevent PHP files from executing'"
SecRule REQUEST_URI 	"/wp-admin/admin-ajax\.php\?action=nm_personalizedproduct_upload_file"	"id:430020,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: Wordpress - Arbitrary File Upload - WooCommerce Extra Fields'"
# Rule 430021 - https://blog.sucuri.net/2017/02/content-injection-vulnerability-wordpress-rest-api.html
SecRule REQUEST_METHOD 	"POST"	 							"id:430021,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - request_uri: Wordpress - Content Injection Vulnerability'"
SecRule REQUEST_URI	"@contains /wp-json/wp/v2/posts"				"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:id		"!^[0-9]+$" 							"t:none,t:lowercase,t:urldecode"
SecRule REQUEST_URI 	"@contains /wp-json/wp/v2/users/"	 			"id:430022,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: Wordpress - Username Enumeration'"
SecRule REQUEST_URI	"/assets/images/.*\.php"					"id:430023,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: ModX - prevent PHP files from executing'"
#SecRule REQUEST_URI     "'.*SELECT "                                            	"id:430024,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: SQL execute'"
#SecRule REQUEST_URI     "'.*OR "                                            		"id:430025,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: SQL execute'"
#SecRule REQUEST_URI     "\(SELECT "                                            		"id:430026,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: SQL execute'"

#
# Request Body
# False: 440000
#SecRule REQUEST_BODY 	"\(\) \{" 							"id:440000,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - Bash ENV Variable Injection Attack'"
SecRule REQUEST_BODY 	"jdatabasedrivermysql" 						"id:440001,phase:2,t:none,t:lowercase,t:urldecode,t:compressWhitespace,deny,log,msg:'Malware.Expert - JDatabaseDriverMysql'"
SecRule REQUEST_BODY 	"cmd=.*&&" 							"id:440002,phase:2,t:none,t:lowercase,t:urldecode,t:compressWhitespace,deny,log,msg:'Malware.Expert - unwanted shell access'"
# Rule 440003 - http://struts.apache.org/docs/s2-016.html
SecRule REQUEST_BODY	"(?:action|redirect|redirectAction):\${"			"id:440003,phase:2,t:none,chain,t:urldecode,t:compressWhitespace,deny,log,msg:'Malware.Expert - remote php execute'"
SecRule REQUEST_BODY    "com.opensymphony.xwork2.dispatcher.HttpServletResponse"	"t:none,t:urldecode"
# Rule 440004 - https://www.trustwave.com/Resources/SpiderLabs-Blog/-Honeypot-Alert--PhpMyAdmin-setup-php-RFI-Attacks-Detected/
SecRule REQUEST_BODY	"action=lay_navigation&eoltype=unix&token=&configuration="	"id:440004,phase:2,t:none,chain,t:urldecode,t:compressWhitespace,deny,log,msg:'Malware.Expert - phpmyadmin: remote file include'"
SecRule REQUEST_BODY    "(?:ftp|http|https|php)://"					"t:none,t:urldecode"
SecRule REQUEST_BODY 	"PHP_SESSION_PHP" 						"id:440005,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - PHP SESSION PHP iFrame'"
SecRule REQUEST_BODY 	"\@eval\(\$_POST\[" 						"id:440006,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - Eval POST'"
SecRule REQUEST_BODY 	"\@eval\x01\(base64_decode\(\$_POST\["	 			"id:440007,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - Eval POST'"
SecRule REQUEST_BODY 	"\@eval\(base64_decode\(\$_POST\["	 			"id:440008,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - Eval POST'"
SecRule REQUEST_BODY 	"PD9waHAgQGV2YWwoJF9QT1NUWy"	 				"id:440009,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - Eval POST'"
SecRule REQUEST_BODY 	"base64_decode\(\$_POST\[.*\]\)\;.*\@eval\("	 		"id:440010,phase:2,t:none,t:urldecode,deny,log,msg:'Malware.Expert - Eval POST'"

#
# Request Args
#
SecRule ARGS 		"eval\(urldecode\(urldecode\(\$_POST" 				"id:450001,phase:2,t:none,t:urldecode,t:compressWhitespace,t:removeWhitespace,deny,log,msg:'Malware.Expert - remote php execute'"
SecRule ARGS 		"eval\(urldecode\(\$_POST" 					"id:450002,phase:2,t:none,t:urldecode,t:compressWhitespace,t:removeWhitespace,deny,log,msg:'Malware.Expert - remote php execute'"
SecRule ARGS		"UNION SELECT"							"id:450003,phase:2,t:none,deny,log,msg:'Malware.Expert - POST SQL execute'"
# Rule 450004
SecRule REQUEST_METHOD 	"POST"	 							"id:450004,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Request Body: phpmyadmin remote download'"
SecRule REQUEST_URI	"/script/setup\.php"						"t:none,t:urldecode,chain"
SecRule ARGS:configuration	"(?:ftp|http|https|php)://" 				"t:none,t:lowercase,t:urldecode"
SecRule ARGS 		"eval\(base64_decode\(array_pop\(\$_POST" 			"id:450005,phase:2,t:none,t:urldecode,t:compressWhitespace,t:removeWhitespace,deny,log,msg:'Malware.Expert - remote php execute'"
SecRule ARGS		"@contains -1 union select 1,2,0x"				"id:450006,phase:2,t:none,deny,log,msg:'Malware.Expert - POST SQL execute'"

#
# Cookies
#
SecRule REQUEST_METHOD 	"POST" 								"id:460000,phase:2,t:none,t:urldecode,chain,deny,log,msg:'Malware.Expert -  cookie - php eval'"
SecRule REQUEST_COOKIES|REQUEST_HEADERS:Cookie  "eval\(urldecode\(" 			"t:none,t:urldecode,t:lowercase"
SecRule REQUEST_COOKIES|REQUEST_HEADERS:Cookie	"\.\./\.\./\.\."			"id:460001,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - cookie: directory travel'"
# Rule 460002 - https://www.pluginvulnerabilities.com/2016/12/15/php-object-injection-vulnerability-in-backup-restore-dropbox/
SecRule REQUEST_COOKIES|REQUEST_HEADERS:Cookie	"@contains file_get_contents"		"id:460002,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - cookie: file_get_contents'"
SecRule REQUEST_COOKIES|REQUEST_HEADERS:Cookie	"@contains file_put_contents"		"id:460003,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - cookie: file_put_contents'"
SecRule &REQUEST_COOKIES_NAMES:wp_cookie 	"@eq 1"					"id:460004,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - wordpress cookie: php eval()'"
SecRule REQUEST_COOKIES|REQUEST_HEADERS:Cookie 	"eval\(base64_decode\(" 		"id:460005,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert -  cookie - php eval'"
SecRule REQUEST_COOKIES|REQUEST_HEADERS:Cookie 	"@contains call_user_func_array" 	"id:460006,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert -  cookie - php call_user_func_array'"

#
# 0-DAY attacks
#
SecRule REQUEST_URI	"genericons/example\.html"					"id:500000,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: 0-Day - Wordpress'"
SecRule REQUEST_URI	"\?gf_page=upload"						"id:500001,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: 0-Day - Gravity Forms'"
SecRule REQUEST_URI	"bluestork/servcie\.php"					"id:500002,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: 0-Day - Joomla'"
SecRule REQUEST_URI	"plugin_googlemap2_proxy\.php\?url="				"id:500003,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: 0-Day - Google Maps Proxy'"
SecRule REQUEST_URI	"bluestork/confgic\.php"					"id:500004,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: 0-Day - Joomla'"
SecRule REQUEST_URI	"stph\.php"							"id:500005,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: 0-Day - stph malware'"

# Rule 500006:https://www.exploit-db.com/exploits/40091/ & https://neonprimetime.blogspot.fi/2016/05/a-file-upload-vulnerability-barrage.html
SecRule REQUEST_METHOD 	"POST" 								"id:500006,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Request Body: 0-Day - PHP Execute'"
SecRule REQUEST_BODY 	"Content-Disposition\: form-data\; name=\"upload\[\]\"\; filename=\"wp-cache.php\"" 		"t:none,t:urldecode,nolog,chain"
SecRule REQUEST_BODY 	"\<\?php" 							"t:none,t:lowercase,t:urldecode,nolog"

SecRule REQUEST_URI 	"revslider_show_image&img=.+/.+\.php" 				"id:500007,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - request_uri: 0-Day - Revslider LFI'"

# Rule 500008:https://sumofpwn.nl/advisory/2016/path_traversal_vulnerability_in_wordpress_core_ajax_handlers.html
SecRule REQUEST_METHOD 	"POST"	 							"id:500008,phase:4,t:none,chain,deny,noauditlog,msg:'Malware.Expert - Request Body: 0-Day - Apache denial of service'"
SecRule REQUEST_URI	"/wp-admin/admin-ajax\.php"					"t:none,t:urldecode,nolog,chain"
SecRule ARGS:plugin 	"/dev/random" 							"t:none,t:lowercase,t:urldecode,nolog"
# Rule 500009:- /cache/cache-db.php
SecRule REQUEST_METHOD 	"POST" 								"id:500009,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - request_uri: 0-Day - Prevent cache.db.php execute'"
SecRule REQUEST_URI	"/cache/cache-db.php"						"t:none,t:urldecode"
# Rule 500010:- /libraries/simplepie/simplepie.lib.php
SecRule REQUEST_METHOD 	"POST" 								"id:500010,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - request_uri: 0-Day - Prevent simplepie.lib.php execute'"
SecRule REQUEST_URI	"/libraries/simplepie/simplepie.lib.php"			"t:none,t:urldecode"

# Rule 500011:Joomla Account Creation (CVE-2016-8870) - component/users/?task=registration.register - https://www.youtube.com/watch?v=Q_2M2oJp5l4 - https://medium.com/@showthread/joomla-3-6-4-account-creation-elevated-privileges-write-up-and-exploit-965d8fb46fa2#.jmbmoeg8r
SecRule REQUEST_METHOD "POST"                                                          	"id:500011,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Joomla Account Creation (CVE-2016-8870)'"
SecRule REQUEST_URI    "@contains /component/users"         				"t:none,t:lowercase,t:urldecode,chain"
SecRule REQUEST_URI    "@contains ?task=registration.register"         			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:option    "@contains com_users"				 		"t:none,chain"
SecRule ARGS:task      "@contains user.register"			 		"t:none"

# Rule 500012: https://www.pluginvulnerabilities.com/2016/09/19/arbitrary-file-upload-vulnerability-in-woocommerce-extra-fields/
SecRule REQUEST_METHOD "POST"                                                          	"id:500012,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - WooCommerce Extra Fields'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"         			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains nm_personalizedproduct_upload_file"			"t:none"

# Rule 500013: https://www.pluginvulnerabilities.com/2016/09/19/arbitrary-file-upload-vulnerability-in-n-media-post-front-end-form/
SecRule REQUEST_METHOD "POST"                                                          	"id:500013,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - WooCommerce Extra Fields'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"         			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains nm_postfront_upload_file"				"t:none"

# Rule 500014: https://www.pluginvulnerabilities.com/tag/arbitrary-file-upload/
SecRule REQUEST_METHOD "POST"                                                          	"id:500014,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - Marketplace'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-post.php?task=wpmp_upload_previews"   "t:none,t:lowercase,t:urldecode"

# Rule 500015: https://www.exploit-db.com/exploits/36738/
SecRule REQUEST_METHOD "POST"                                                          	"id:500015,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - N-Media Website Contact Form'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"         			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains nm_webcontact_upload_file"				"t:none"

# Rule 500016: https://www.exploit-db.com/exploits/36614/
SecRule REQUEST_METHOD "POST"                                                          		"id:500016,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - Simple Ads Manager'"
SecRule REQUEST_URI    "@contains /wp-content/plugins/simple-ads-manager/sam-ajax-admin.php"	"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains upload_ad_image"						"t:none"

# Rule 500017:http://www.skepticism.us/2015/09/attacker-attempts-to-install-minimalist-backdoor-via-post-license-php/
SecRule REQUEST_METHOD "POST"                                                          	"id:500017,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload'"
SecRule ARGS:yiw_action "@contains sendemail"					 	"t:none,chain"
SecRule ARGS:id_form    "@contains a_3_3"				 		"t:none"

# Rule 500018:
SecRule REQUEST_METHOD "POST"                                                          	"id:500018,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - RevSlider Arbitrary File Upload'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"      			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@pm revslider_ajax_action revolution-slider_ajax_action"	"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:client_action      "@contains update_plugin"			 	"t:none,t:lowercase,t:urldecode"

# Rule 500019:
SecRule REQUEST_METHOD "POST"                                                          	"id:500019,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - ModX - ajaxSearchPopup.php Vulnerability'"
SecRule REQUEST_URI    "@contains /index-ajax.php"      				"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:ucfg      "@contains eval("			 			"t:none,t:lowercase,t:urldecode,t:compressWhitespace,t:removeWhitespace,t:removecommentschar"

# Rule 500020:
SecRule REQUEST_METHOD "POST"                                                          	"id:500020,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - Theme'"
SecRule REQUEST_URI    "/wp-content/themes/.+/include/lang_upload\.php"  		"t:none,t:lowercase,t:urldecode"

# Rule 500021:
SecRule REQUEST_METHOD "POST"                                                          	"id:500021,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Magento - Arbitrary File Upload - Downloader'"
SecRule REQUEST_URI    "@contains /downloader/index.php?a=connectinstallpackageupload&maintenance=1&archive_type=0&backup_name=" 	"t:none,t:lowercase,t:urldecode"

# Rule 500022:
SecRule REQUEST_METHOD "POST"                                                          	"id:500022,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - load_ajax_function (viewguestfiles) Vulnerability'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php?action=load_ajax_function"   "t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS_NAMES     "@contains files"		 				"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS_NAMES     "@contains viewguestfiles"			 		"t:none,t:lowercase"

# Rule 500023:
SecRule REQUEST_METHOD "POST"                                                          	"id:500023,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - jquery-html5-file-upload - Vulnerability'"
SecRule REQUEST_URI    "@contains /wp-admin/wp-content/plugins/.+/jquery-html5-file-upload.php"   "t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:accepted_file_types     "@contains php"		 			"t:none,t:lowercase,t:urldecode"

# Rule 500024: https://g0blin.co.uk/g0blin-00036/
SecRule REQUEST_METHOD "POST"                                                          	"id:500024,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Wpshop - Arbitrary File Upload - Vulnerability'"
SecRule REQUEST_URI    "@contains /wp-content/plugins/wpshop/includes/ajax.php"   	"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:elementCode     "@contains ajaxupload"		 			"t:none,t:lowercase,t:urldecode"

# Rule 500025: https://wpvulndb.com/vulnerabilities/7939
SecRule REQUEST_METHOD "POST"                                                          	"id:500025,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Ultimate Product Catalogue - Arbitrary File Upload - Vulnerability'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php?action=widgets_init&Action=UPCP_AddProductSpreadsheet"   	"t:none,t:urldecode"
#SecRule FILES:Products_Spreadsheet       "@gt 0"		 			"t:none,t:urldecode"

# Rule 500026: https://www.exploit-db.com/exploits/37166/
SecRule REQUEST_METHOD "POST"                                                          	"id:500026,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - dzs-zoomsounds - Arbitrary File Upload - Vulnerability'"
SecRule REQUEST_URI    "@contains /wp-content/plugins/dzs-zoomsounds/admin/upload.php"  "t:none,t:lowercase,t:urldecode,chain"
SecRule FILES_NAMES    "@contains file_field"		 				"t:none,t:lowercase,t:urldecode"

# Rule 500027: https://forum.dracos-linux.org/topic/php/thread/90/
SecRule REQUEST_METHOD "POST"                                                          	"id:500027,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Prestashop - Arbitrary File Upload - Vulnerability'"
SecRule REQUEST_URI    "@contains /modules/simpleslideshow/uploadimage.php"  		"t:none,t:lowercase,t:urldecode,chain"
SecRule FILES_NAMES    "@contains userfile"		 				"t:none,t:lowercase,t:urldecode"

# Rule 500028: WSO - PHP Command Shell
SecRule REQUEST_URI	"@contains /wp-content/upgrade/wp/wp.php"			"id:500028,phase:2,t:none,t:lowercase,t:urldecode,deny,noauditlog,msg:'Malware.Expert - PHP Command Shell (WSO)'"

# Rule 500029:
SecRule REQUEST_METHOD "POST"                                                          	"id:500029,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - Vulnerability'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-post.php?page=wysija_campaigns&action=themes"   	"t:none,t:lowercase,t:urldecode,chain"
SecRule FILES_NAMES    "@contains my-theme"		 				"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:overwriteexistingtheme     "@contains on"		 			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains themeupload"		 				"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:submitter "@contains upload"		 				"t:none,t:lowercase,t:urldecode"

# Rule 500030:
SecRule REQUEST_METHOD "POST"                                                          	"id:500030,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - RevSlider Arbitrary File Upload'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"      			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains showbiz_ajax_action"		 			"t:none,chain"
SecRule ARGS:client_action      "@contains update_plugin"			 	"t:none"

# Rule 500031: https://howucan.gr/vulnerabilities/wordpress-exploits/681-wordpress-vulnerability-in-cherry-plugin-arbitrary-file-upload
SecRule REQUEST_METHOD "POST"                                                          	"id:500031,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - Cherry Plugin'"
SecRule REQUEST_URI    "@contains /wp-content/plugins/cherry-plugin/admin/import-export/upload.php"  		"t:none,t:lowercase,t:urldecode"

# Rule 500032: https://www.exploit-db.com/exploits/36490/
SecRule REQUEST_METHOD "POST"                                                          	"id:500032,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Marketplace - Remote Code Execution'"
SecRule ARGS:action    "(wpmp_pp_ajax_call|wpdm_ajax_call)"		 		"t:none,t:lowercase,chain"
SecRule ARGS:execute   "@contains wp_insert_user"			 		"t:none,t:lowercase"

# Rule 500033: https://www.exploit-db.com/exploits/40968/
SecRule REQUEST_METHOD "POST"                                                          	"id:500033,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - PHPMailer - Remote Code Execution'"
SecRule ARGS:name      "@contains <?"		 					"t:none,t:lowercase,chain"
SecRule ARGS_NAMES     "@contains email"			   		        "t:none,t:lowercase"

# Rule 500034:
SecRule REQUEST_METHOD "POST"                                                          	"id:500034,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - Themes'"
SecRule REQUEST_URI    "/wp-content/themes/.+/functions/upload-handler\.php"  		"t:none,t:lowercase,t:urldecode"

# Rule 500035: https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_COOKIES_NAMES
SecRule REQUEST_METHOD "POST"                                                          	"id:500035,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Joomla - Arbitrary File Upload'"
SecRule ARGS:option    "@contains com_media"		 				"t:none,t:lowercase,chain"
SecRule ARGS:task      "@contains file.upload"		 				"t:none,t:lowercase,chain"
SecRule ARGS:tmpl      "@contains component"		 				"t:none,t:lowercase,chain"
SecRule &REQUEST_HEADERS_NAMES:Referer "@eq 0"						"t:none,t:lowercase"

# Rule 500036: https://klikki.fi/adv/pagelines-fi.html
SecRule REQUEST_METHOD "POST"                                                          	"id:500036,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - PageLines Theme - Arbitrary File Uploads'"
#SecRule REQUEST_URI    "@contains /wp-admin/admin-post.php?page=pagelines"  		"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:page    "@contains pagelines"  						"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:settings_upload    "@contains settings"		 			"t:none,t:lowercase"

# Rule 500037: Joomla Account Creation (CVE-2016-8870) - component/users/?task=registration.register - https://www.youtube.com/watch?v=Q_2M2oJp5l4 - https://medium.com/@showthread/joomla-3-6-4-account-creation-elevated-privileges-write-up-and-exploit-965d8fb46fa2#.jmbmoeg8r
SecRule REQUEST_METHOD "POST"                                                          "id:500037,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Joomla Account Creation (CVE-2016-8870)'"
SecRule REQUEST_URI    "@contains /component/users"      		   		"t:none,t:lowercase,t:urldecode,chain"
SecRule REQUEST_URI    "@contains ?task=user.register" 	 	       			"t:none,t:lowercase,t:urldecode"
#SecRule ARGS:option    "@contains com_users"				 		"t:none,chain"
#SecRule ARGS:task      "@contains user.register"			 		"t:none"

# Rule 500038: Wordpress Google Form RFI
SecRule REQUEST_METHOD "POST"                                                          "id:500038,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Google Forms (RFI)'"
SecRule ARGS_NAMES	"@contains wpgform-action"		 	       		"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS_NAMES	"@contains file"		 	       			"t:none,t:lowercase,t:urldecode,chain"
SecRule REQUEST_BODY    "(?:ftp|http|https|php)://"					"t:none,t:lowercase,t:urldecode"

# Rule 500039: WordPress WP All Import Plugin RCE - https://cxsecurity.com/issue/WLB-2015030004
SecRule REQUEST_METHOD "POST"                                                          "id:500039,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - WordPress WP All Import Plugin RCE'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"                             "t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:page      "@contains pmxi-admin-settings"                                  "t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains upload"                                               "t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:name      ".(?:php|phtml)"                                                 "t:none,t:lowercase,t:urldecode"

# Rule 500040: Magento Shoplift - https://blog.sucuri.net/2015/04/magento-shoplift-supee-5344-exploits-in-the-wild.html
SecRule REQUEST_METHOD "POST"                                                          	"id:500040,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Magento Shoplift vulnerability'"
SecRule REQUEST_URI    "@contains /cms_wysiwyg/directive/index/"  			"t:none,t:lowercase,t:urldecode"

# Rule 500041: Wordpress nextgen sql - https://blog.sucuri.net/2017/02/sql-injection-vulnerability-nextgen-gallery-wordpress.html
SecRule REQUEST_URI "@contains %1$%s"                     		                "id:500041,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - Wordpress NextGen SQL vulnerability'"

# Rule 500042: WordPress Plugin - WP Power Stats
SecRule REQUEST_METHOD "POST"                                                           "id:500042,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - WordPress Plugin - WP Power Stats (RFI)'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"                             "t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS_NAMES     "@contains file"                                  		"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS_NAMES     "@contains dest"                                  		"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains power_stats_track"                                    "t:none,t:lowercase,t:urldecode"

# Rule 500043:
SecRule REQUEST_METHOD "POST"                                                           "id:500043,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Joomla upload vulnerability'"
SecRule REQUEST_URI    "@contains /administrator/index.php?option=com_installer&videw=install"	"t:none,t:lowercase,t:urldecode"

# Rule 500044: Joomla 3.7.0 - SQL Injection
SecRule REQUEST_METHOD "GET"                                                            "id:500044,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Joomla 3.7 Core - SQL Injection'"
SecRule REQUEST_URI    "@contains /index.php"                             		"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:option    "@contains com_fields"                                  		"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:view      "@contains fields"                                  		"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:layout    "@contains modal"                                    		"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS_NAMES     "@contains list[fullordering]"                                   "t:none,t:lowercase,t:urldecode"

# Rule 500045:
SecRule REQUEST_METHOD "POST"                                                          	"id:500045,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - Malware execute'"
SecRule REQUEST_URI    "/wp-content/plugins/.+/images/.*\.php"  			"t:none,t:lowercase,t:urldecode"

# Rule 500046:
SecRule REQUEST_METHOD "POST"                                                          	"id:500046,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - SQL Injection'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"      			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:post_id   "union.+select"							"t:none,t:lowercase,t:urldecode"

# Rule 500047:
SecRule REQUEST_METHOD "POST"                                                          	"id:500047,phase:2,t:none,chain,deny,log,msg:'Malware.Expert - Wordpress - remote file include - Ultimate Form Builder Lite'"
SecRule REQUEST_URI    "@contains /wp-admin/admin-ajax.php"         			"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:action    "@contains ufbl_front_form_action"				"t:none,t:lowercase,t:urldecode,chain"
SecRule ARGS:file      "@contains http://"						"t:none,t:lowercase,t:urldecode"

#
# Block Malware & Vulnerability Urls
#

# Rule 570000
SecRule REQUEST_METHOD "POST"                                                          	"id:570000,phase:1,t:none,chain,drop,noauditlog,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - WP Symposium'"
SecRule REQUEST_URI    "@contains /wp-content/plugins/wp-symposium/server/php/"         "t:none,t:lowercase,t:urldecode"

# Rule 570001 - http://k3dsec.blogspot.fi/2015/03/wordpress-plugin-inboundio-marketing.html
SecRule REQUEST_METHOD "POST"                                                          	"id:570001,phase:2,t:none,chain,drop,noauditlog,msg:'Malware.Expert - Wordpress - Arbitrary File Upload - Inbound Marketing'"
SecRule REQUEST_URI    "@contains /wp-content/plugins/inboundio-marketing/admin/partials/csv_uploader.php"         "t:none,t:lowercase,t:urldecode"

# Rule 570002 - http://black-cybersec-crew.blogspot.fi/2013/10/joomla-comfabrik-upload-vulnerability.html
SecRule REQUEST_METHOD "POST"                                                          	"id:570002,phase:2,t:none,chain,drop,noauditlog,msg:'Malware.Expert - Joomla - Arbitrary File Upload - ComFabrik'"
SecRule REQUEST_URI    "@contains /index.php?option=com_fabrik&c=import&view=import&filetype=csv&table=1"         "t:none,t:lowercase,t:urldecode"

# Rule 570003 - https://gist.github.com/googleinurl/bacce3142636e50f2148
SecRule REQUEST_METHOD "POST"                                                          	"id:570003,phase:2,t:none,chain,drop,noauditlog,msg:'Malware.Expert - Joomla - Arbitrary File Upload - Adsmanager'"
SecRule REQUEST_URI    "@contains /index.php?option=com_adsmanager&task=upload&tmpl=component"         "t:none,t:lowercase,t:urldecode"

# Rule 570004 - https://www.exploit-db.com/exploits/17303/
SecRule REQUEST_METHOD "POST"                                                          	"id:570004,phase:2,t:none,chain,drop,noauditlog,msg:'Malware.Expert - Joomla - Arbitrary File Upload - Jdownloads'"
SecRule REQUEST_URI    "@contains /index.php?option=com_jdownloads&itemid=0&view=upload"         "t:none,t:lowercase,t:urldecode"

# Rule 570005
SecRule REQUEST_METHOD "POST"                                                          	"id:570005,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-content/common.php"         			"t:none,t:lowercase,t:urldecode"

# Rule 570006
SecRule REQUEST_METHOD "POST"                                                          	"id:570006,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-content/main_.php"         			"t:none,t:lowercase,t:urldecode"

# Rule 570007
SecRule REQUEST_URI 	"@contains .php?z3="	 					"id:570007,phase:2,t:none,t:lowercase,t:urldecode,deny,noauditlog,msg:'Malware.Expert - Generic - Malware'"

# Rule 570008
SecRule REQUEST_METHOD "POST"                                                          	"id:570008,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-admin/includes/index.php"         		"t:none,t:lowercase,t:urldecode"

# Rule 570009
SecRule REQUEST_METHOD "POST"                                                          	"id:570009,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-admin/includes/admin-api.php"         		"t:none,t:lowercase,t:urldecode"

# Rule 570010
SecRule REQUEST_METHOD "POST"                                                          	"id:570010,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-content/plugins/wp-zipp/wp-zipp.php"     		"t:none,t:lowercase,t:urldecode"

# Rule 570011 - https://malware.expert/backdoor/silence-is-golden/
SecRule REQUEST_METHOD "POST"                                                          	"id:570011,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule ARGS_NAMES     "@streq bot"     							"t:none,t:lowercase,t:urldecode"

# Rule 570012
SecRule REQUEST_URI 	"@contains /wp-info.php"	 				"id:570012,phase:2,t:none,t:lowercase,t:urldecode,deny,noauditlog,msg:'Malware.Expert - wp-info.php - Malware'"

# Rule 570013
SecRule REQUEST_URI 	"@contains /embrace.php"	 				"id:570013,phase:2,t:none,t:lowercase,t:urldecode,deny,noauditlog,msg:'Malware.Expert - embrace.php - Malware'"

# Rule 570014
SecRule REQUEST_METHOD "POST"                                                          	"id:570014,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "/wp-admin/css/.*\.php"         					"t:none,t:lowercase,t:urldecode"

# Rule 570015 - filebox.php - shell
SecRule REQUEST_URI 	"@contains /filebox.php?op="	 				"id:570015,phase:2,t:none,t:lowercase,t:urldecode,deny,noauditlog,msg:'Malware.Expert - Command Shell execution'"

# Rule 570016
SecRule REQUEST_METHOD "POST"                                                          	"id:570016,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - File Upload - Malware'"
SecRule ARGS:baglisse     "@streq dz"     						"t:none,t:lowercase,t:urldecode"

# Rule 570017
SecRule REQUEST_METHOD "POST"                                                          	"id:570017,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-content/index.php"         			"t:none,t:lowercase,t:urldecode"

# Rule 570018
SecRule REQUEST_METHOD "POST"                                                          	"id:570018,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-content/themes/index.php"        			"t:none,t:lowercase,t:urldecode"

# Rule 570019
SecRule REQUEST_METHOD "POST"                                                          	"id:570019,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-content/plugins/index.php"        		"t:none,t:lowercase,t:urldecode"

# Rule 570020
SecRule REQUEST_METHOD "POST"                                                          	"id:570020,phase:2,t:none,chain,drop,log,msg:'Malware.Expert - Wordpress - Malware'"
SecRule REQUEST_URI    "@contains /wp-content/functions.php"	        		"t:none,t:lowercase,t:urldecode"

#
# php upload whitelist
#
# Rule 590000: Wordpress Plugin update (for php file)
#SecRule REQUEST_METHOD "POST"								"id:590000,phase:2,t:none,chain,pass,skipAfter:IGNORE_PHP_UPLOAD,nolog,msg:'Malware.Expert - Wordpress Plugin Install'"
#SecRule REQUEST_URI    "@contains /wp-admin/update.php?action=upload-plugin"		"t:none,t:lowercase,t:urldecode,nolog,chain"
#SecRule REQUEST_HEADERS:Referer "@contains /wp-admin/plugin-install.php"		"t:none,t:lowercase,t:urldecode,nolog"

#
# php upload prevent
#
SecRule FILES 		"@rx \.php" 							"id:'600000',phase:2,t:none,t:lowercase,t:urldecode,drop,log,msg:'Malware.Expert - PHP files not allowed upload'"
SecRule FILES_NAMES 	"@rx \.php" 							"id:'600001',phase:2,t:none,t:lowercase,t:urldecode,drop,log,msg:'Malware.Expert - PHP files not allowed upload'"
SecRule FILES 		"@rx \.phtml" 							"id:'600002',phase:2,t:none,t:lowercase,t:urldecode,drop,log,msg:'Malware.Expert - PHP files not allowed upload'"
SecRule FILES_NAMES 	"@rx \.phtml" 							"id:'600003',phase:2,t:none,t:lowercase,t:urldecode,drop,log,msg:'Malware.Expert - PHP files not allowed upload'"

SecMarker	IGNORE_PHP_UPLOAD

#
# Test Rules
#

SecRule REQUEST_URI    "@contains malware_expert_test_rule"				"id:900000,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - Test rule'"
SecRule QUERY_STRING   "@contains malware_expert_test_rule"				"id:900001,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'Malware.Expert - Test rule'"

#Content-Disposition: form-data; name="upload[]"; filename="wp-cache.php"
#<?php @eval($_POST['sense']);?>45000
#https://www.pfsense.org/packages/config/apache_mod_security/rules/10_asl_rules.conf

# https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#secremoterules
# SecRule REQUEST_URI "/images/stories/.+\.php" "deny,id:5000219,msg:'Malware.Expert - Joomla com_jce code exec'"
# That exploit puts PHP files into site.com/images/stories/something.php

SecRule REMOTE_ADDR "@ipMatchFromFile /etc/asl/whitelist" "id:1,rev:1,phase:2,nolog,allow"

#Cgi ni perl
SecRule REQUEST_URI "^\S+\.pl\S+$" "log,deny,msg:'Acceso denegado',status:403,id:21"
SecRule REQUEST_URI "^\S+\.cgi$" "log,deny,msg:'Acceso denegado',status:403,id:2"
SecRule REQUEST_URI "^\S+perl$" "log,deny,msg:'Acceso denegado',status:403,id:41223"
SecRule REQUEST_URI "wget"	"id:130007,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'PHrules'"
SecRule REQUEST_URI "^\S+curl\S+\.php$"    "id:130002,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'PHrules'"

#Prestashop
SecRule REQUEST_URI "^\S+modules/simpleslidershow\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4035"
SecRule REQUEST_URI "^\S+modules/simpleslidershow/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4036"
SecRule REQUEST_URI "^\S+modules/columnadverts\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4037"
SecRule REQUEST_URI "^\S+modules/columnadverts/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4038"
SecRule REQUEST_URI "^\S+modules/homepagesadvertise\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4039"
SecRule REQUEST_URI "^\S+modules/homepagesadvertise/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4040"
SecRule REQUEST_URI "^\S+modules/productpageadverts\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4041"
SecRule REQUEST_URI "^\S+modules/productpageadverts/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4042"
SecRule REQUEST_URI "^\S+modules/sendtoafriend\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4043"
SecRule REQUEST_URI "^\S+modules/sendtoafriend/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4044"
SecRule REQUEST_URI "^\S+modules/columnadverts\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4045"
SecRule REQUEST_URI "^\S+modules/columnadverts/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4046"
SecRule REQUEST_URI "^\S+modules/soopamobile\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4047"
SecRule REQUEST_URI "^\S+modules/soopamobile/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4048"
SecRule REQUEST_URI "^\S+modules/soopabanners\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4049"
SecRule REQUEST_URI "^\S+modules/soopabanners/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4050"
SecRule REQUEST_URI "^\S+modules/columnadverts\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4051"
SecRule REQUEST_URI "^\S+modules/columnadverts/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4052"
SecRule REQUEST_URI "^\S+modules/vtermslideshow\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4053"
SecRule REQUEST_URI "^\S+modules/vtermslideshow/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4054"
SecRule REQUEST_URI "^\S+modules/simpleslideshow\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4055"
SecRule REQUEST_URI "^\S+modules/simpleslideshow/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4056"
SecRule REQUEST_URI "^\S+modules/productpageadverts\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4057"
SecRule REQUEST_URI "^\S+modules/productpageadverts/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4058"
SecRule REQUEST_URI "^\S+modules/homepageadvertise\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4059"
SecRule REQUEST_URI "^\S+modules/homepageadvertise/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4060"
SecRule REQUEST_URI "^\S+modules/attributewizardpro\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4061"
SecRule REQUEST_URI "^\S+modules/attributewizardpro/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4062"
SecRule REQUEST_URI "^\S+modules/advancedslider\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4063"
SecRule REQUEST_URI "^\S+modules/advancedslider/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4064"
SecRule REQUEST_URI "^\S+modules/cartabandonmentpro\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4065"
SecRule REQUEST_URI "^\S+modules/cartabandonmentpro/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4066"
SecRule REQUEST_URI "^\S+modules/wg24themeadministration\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4067"
SecRule REQUEST_URI "^\S+modules/wg24themeadministration/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4068"
SecRule REQUEST_URI "^\S+modules/wdoptionpanel\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4069"
SecRule REQUEST_URI "^\S+modules/wdoptionpanel/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4070"
SecRule REQUEST_URI "^\S+modules/fieldvmegamenu\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4071"
SecRule REQUEST_URI "^\S+modules/fieldvmegamenu/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4072"
SecRule REQUEST_URI "^\S+modules/megamenu\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4073"
SecRule REQUEST_URI "^\S+modules/megamenu/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4074"
SecRule REQUEST_URI "^\S+modules/pk_flexmenu\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4075"
SecRule REQUEST_URI "^\S+modules/pk_flexmenu/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4076"
SecRule REQUEST_URI "^\S+modules/wg24themeadministration\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4077"
SecRule REQUEST_URI "^\S+modules/wg24themeadministration/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4078"
SecRule REQUEST_URI "^\S+modules/pk_vertflexmenu\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4079"
SecRule REQUEST_URI "^\S+modules/pk_vertflexmenu/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4080"
SecRule REQUEST_URI "^\S+modules/nvn_export_orders\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4081"
SecRule REQUEST_URI "^\S+modules/nvn_export_orders/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4082"
SecRule REQUEST_URI "^\S+modules/orderfiles\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4083"
SecRule REQUEST_URI "^\S+modules/orderfiles/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4084"
SecRule REQUEST_URI "phpunit" "log,deny,msg:'Acceso denegado',status:403,id:66777"

#Wordpress
SecRule REQUEST_URI "^\S+installer-backup\.php$" "log,deny,msg:'Acceso denegado',status:403,id:36500"
SecRule REQUEST_URI "^\S+installer-backup\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:36600"
SecRule REQUEST_URI "^\S+wp-content/\S+timthumb\.php$" "rev:1,id:345671,phase:1,t:none,nolog,allow,ctl:ruleEngine=Off,ctl:auditEngine=Off"
SecRule REQUEST_URI "^\S+wp-content/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:3"
SecRule REQUEST_URI "^\S+wp-content/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4"
SecRule REQUEST_URI "^\S+wp-content/uploads/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:5"
SecRule REQUEST_URI "^\S+wp-includes/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:35"
#SecRule REQUEST_URI "^\S+wp-includes/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:36"
#SecRule REQUEST_URI "^\S+xmlrpc\.php$" "log,deny,msg:'Acceso denegado',status:403,id:30500"
#SecRule REQUEST_URI "^\S+xmlrpc\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:3600"
SecRule REQUEST_URI "swpsmtp_settings" "log,deny,msg:'Acceso denegado',status:403,id:70989"
SecRule REQUEST_URI "/wp-admin/admin-post\.php\?page=yuzo-related-post"	"id:70990,phase:2,t:none,t:lowercase,t:urldecode,deny,log,msg:'ProfesionalHosting - request_uri: Wordpress - Pluggin Yuzo Related Post'"

#Joomla
SecRule REQUEST_URI "^\S+images/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:6"
SecRule REQUEST_URI "^\S+images/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:7"
SecRule REQUEST_URI "^\S+components/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:8"
SecRule REQUEST_URI "^\S+components/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:9"
SecRule REQUEST_URI "^\S+logs/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:10"
SecRule REQUEST_URI "^\S+logs/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:11"
SecRule REQUEST_URI "^\S+media/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:12"
SecRule REQUEST_URI "^\S+media/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:13"
SecRule REQUEST_URI "^\S+tmp/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:14"
SecRule REQUEST_URI "^\S+tmp/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:15"
SecRule REQUEST_URI "^\S+templates/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:16"
SecRule REQUEST_URI "^\S+templates/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:17"
SecRule REQUEST_URI "^\S+plugins/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:18"
SecRule REQUEST_URI "^\S+plugins/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:19"
SecRule REQUEST_URI "^\S+libraries/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:180"
SecRule REQUEST_URI "^\S+libraries/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:181"
SecRule REQUEST_URI "^\S+DatabaseDriverMysql$" "log,deny,msg:'Acceso denegado',status:403,id:4520"
SecRule REQUEST_URI "^\S+file_put_contents$" "log,deny,msg:'Acceso denegado',status:403,id:4522"
SecRule REQUEST_URI "^\S+base64_decode$" "log,deny,msg:'Acceso denegado',status:403,id:4524"

#drupal
SecRule REQUEST_URI "^\S+sites/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:22"
SecRule REQUEST_URI "^\S+sites/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:23"

#magento
SecRule REQUEST_URI "^\S+skin/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:24"
SecRule REQUEST_URI "^\S+skin/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:25"
SecRule REQUEST_URI "^\S+lib/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:2455"
SecRule REQUEST_URI "^\S+lib/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:2555"
SecRule REQUEST_URI "^\S+code/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:11111"
SecRule REQUEST_URI "^\S+code/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:11112"
SecRule REQUEST_URI "^\S+app/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:11115"
SecRule REQUEST_URI "^\S+app/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:11116"
SecRule REQUEST_URI "^\S+route=account/register$" "log,deny,msg:'Acceso denegado',status:403,id:11117"
SecRule REQUEST_URI "^\S+route=account/registerS+$" "log,deny,msg:'Acceso denegado',status:403,id:11118"

#varios
SecRule REQUEST_URI "^\S+images/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:26"
SecRule REQUEST_URI "^\S+images/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:27"

SecRule REQUEST_URI "^\S+upload/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:28"
SecRule REQUEST_URI "^\S+upload/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:29"

SecRule REQUEST_URI "^\S+imagenes/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:30"
SecRule REQUEST_URI "^\S+imagenes/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:31"

SecRule REQUEST_URI "^\S+js/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:32"
SecRule REQUEST_URI "^\S+js/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:33"

#SecRule REQUEST_URI "^\S+install/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4567"
#SecRule REQUEST_URI "^\S+install/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4568"
#SecRule REQUEST_URI "^\S+installation/\S+\.php$" "log,deny,msg:'Acceso denegado',status:403,id:4569"
#SecRule REQUEST_URI "^\S+installation/\S+\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:4570"
#SecRule REQUEST_URI "^\S+install\.php$" "log,deny,msg:'Acceso denegado',status:403,id:32200"
#SecRule REQUEST_URI "^\S+install\.php\S+$" "log,deny,msg:'Acceso denegado',status:403,id:33600"
